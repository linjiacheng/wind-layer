!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).windLayer=e()}(this,function(){"use strict";function p(p){void 0===p&&(p={}),this.params=p;var S=this;function e(t){t.projection||(t.projection="EPSG:4326"),S.MIN_VELOCITY_INTENSITY=t.minVelocity||0,S.MAX_VELOCITY_INTENSITY=t.maxVelocity||10,S.VELOCITY_SCALE=(t.velocityScale||.005)*(Math.pow(window.devicePixelRatio,1/3)||1),S.MAX_PARTICLE_AGE=t.particleAge||90,S.PARTICLE_LINE_WIDTH=t.lineWidth||1,S.PARTICLE_MULTIPLIER=t.particleMultiplier||1/300,S.PARTICLE_REDUCTION=Math.pow(window.devicePixelRatio,1/3)||1.6,S.FRAME_RATE=t.frameRate||16,S.COLOR_SCALE=t.colorScale||i,S.OVERLAY_COLOR_SCALE=t.overlayColorScale||n,S.OVERLAY_ALPHA=Math.floor(153)}S.canvas=p.canvas;var i=["rgb(36,104, 180)","rgb(60,157, 194)","rgb(128,205,193 )","rgb(151,218,168 )","rgb(198,231,181)","rgb(238,247,217)","rgb(255,238,159)","rgb(252,217,125)","rgb(255,182,100)","rgb(252,150,75)","rgb(250,112,52)","rgb(245,64,32)","rgb(237,45,28)","rgb(220,24,32)","rgb(180,0,35)"],n=[[193,[37,4,42]],[206,[41,10,130]],[219,[81,40,40]],[233.15,[192,37,149]],[255.372,[70,215,215]],[273.15,[21,84,187]],[275.15,[24,132,14]],[291,[247,251,59]],[298,[235,167,21]],[311,[230,71,39]],[328,[88,27,67]]];function a(t,e,i,n,a,o){var r=1-t,s=1-e;return i*r*s+n*t*s+a*r*e+o*t*e}function o(t,e,i,n,a,o){var r=1-t,s=1-e,h=r*s,c=t*s,l=r*e,p=t*e,u=i[0]*h+n[0]*c+a[0]*l+o[0]*p,d=i[1]*h+n[1]*c+a[1]*l+o[1]*p;return[u,d,Math.sqrt(u*u+d*d)]}function h(t){var e=null,i=null,n=null;return t.forEach(function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":e=t;break;case"1,3":case"2,3":i=t;break;default:n=t}}),null!=n?function(t){L=!1;var e=t.data;return{header:t.header,interpolate:a,data:function(t){return e[t]}}}(n):function(t,e){L=!0;var i=t.data,n=e.data;return{header:t.header,data:function(t){return[i[t],n[t]]},interpolate:o}}(e,i)}e(p),window.FRAME_TIME=1e3/S.FRAME_RATE;var d,f,c,y,g,v,m,l,u,r=[NaN,NaN,null],s=S.params.data,L=!0,w=function(t,e){if(!f)return null;var i,n=_(t-y,360)/v,a=(g-e)/m,o=Math.floor(n),r=o+1,s=Math.floor(a),h=s+1;if(i=f[s]){var c=i[o],l=i[r];if(b(c)&&b(l)&&(i=f[h])){var p=i[o],u=i[r];if(b(p)&&b(u))return d.interpolate(n-o,a-s,c,l,p,u)}}return null},b=function(t){return null!=t},_=function(t,e){return t-e*Math.floor(t/e)},M=function(t,e,i){return(function(t,e){return Math.max(e[0],Math.min(t,e[1]))}(t,[e,i])-e)/(i-e)},x=function(t,e){var i=t[0],n=t[1],a=t[2],o=e[0]-i,r=e[1]-n,s=e[2]-a;return function(t,e){return[Math.floor(i+t*o),Math.floor(n+t*r),Math.floor(a+t*s),e]}};function P(t){for(var a=[],o=[],r=[],e=0;e<t.length-1;e++)a.push(t[e+1][0]),o.push(x(t[e][1],t[e+1][1])),r.push([t[e][0],t[e+1][0]]);return function(t,e){var i;for(i=0;i<a.length-1&&!(t<=a[i]);i++);var n=r[i];return o[i](M(t,n[0],n[1]),e)}}function T(n,a,t,e){function o(t,e){var i=n[Math.round(t)];return i&&i[Math.round(e)]||r}o.release=function(){n=[]},o.randomize=function(t){for(var e,i,n=0;null===o(e=Math.round(Math.floor(Math.random()*a.width)+a.x),i=Math.round(Math.floor(Math.random()*a.height)+a.y))[2]&&n++<30;);return t.x=e,t.y=i,t},o.overlay=t.imageData,e(a,o)}function E(t){return t/180*Math.PI}function I(t){return t/(Math.PI/180)}var R,W=function(t,e,i,n,a,o){var r=2*Math.PI,s="EPSG:4326"===S.params.projection?5:Math.pow(10,-5.2),h=e<0?s:-s,c=i<0?s:-s,l=F(i,e+h,o),p=F(i+c,e,o),u=Math.cos(i/360*r);return[(l[0]-n)/h/u,(l[1]-a)/h/u,(p[0]-n)/c,(p[1]-a)/c]};function C(t){return Math.log(Math.tan(t/2+Math.PI/4))}function A(_,M,x,i){var E=function(t){var e=document.createElement("canvas"),a=t.width,i=t.height;e.width=a,e.height=i;var n=e.getContext("2d");n.fillStyle="rgba(255, 0, 0, 1)",n.fill();var o=n.getImageData(0,0,a,i),r=o.data;return{imageData:o,isVisible:function(t,e){return 0<r[3+4*(e*a+t)]},set:function(t,e,i){var n=4*(e*a+t);return r[n]=i[0],r[1+n]=i[1],r[2+n]=i[2],r[3+n]=i[3],this}}}(M),I={},t=(x.south-x.north)*(x.west-x.east),C=S.VELOCITY_SCALE*Math.pow(t,.4),A=[],n=M.x;function a(t){for(var e,i,n,a,o,r,s,h,c,l,p,u=[],d=M.y;d<=M.yMax;d+=2){var f=R(t,d,x),y=[0,0,0,0];if(f){var g=f[0],v=f[1];if(isFinite(g)){var m=_.interpolate(g,v),w=null;m&&(L?(e=I,i=g,n=v,a=t,o=d,r=C,h=x,void 0,c=(s=m)[0]*r,l=s[1]*r,p=W(e,i,n,a,o,h),s[0]=p[0]*c+p[2]*l,s[1]=p[1]*c+p[3]*l,m=s,u[d+1]=u[d]=m):w=m),b(w)&&(y=P(S.OVERLAY_COLOR_SCALE)(w,OVERLAY_ALPHA))}}E.set(t,d,y).set(t+1,d,y).set(t,d+1,y).set(t+1,d+1,y)}A[t+1]=A[t]=u}!function t(){for(var e=Date.now();n<M.width;)if(a(n),n+=2,1e3<Date.now()-e)return void setTimeout(t,25);T(A,M,E,i)}()}function N(n,s){var e,i,h=(e=S.MIN_VELOCITY_INTENSITY,i=S.MAX_VELOCITY_INTENSITY,S.COLOR_SCALE.indexFor=function(t){return Math.max(0,Math.min(S.COLOR_SCALE.length-1,Math.round((t-e)/(i-e)*(S.COLOR_SCALE.length-1))))},S.COLOR_SCALE),c=h.map(function(){return[]}),t=Math.round(n.width*n.height*S.PARTICLE_MULTIPLIER);/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)&&(t*=S.PARTICLE_REDUCTION);for(var a=[],o=0;o<t;o++)a.push(s.randomize({age:Math.floor(Math.random()*S.MAX_PARTICLE_AGE)+0}));var r=S.canvas.getContext("2d");r.lineWidth=S.PARTICLE_LINE_WIDTH,r.fillStyle="rgba(0, 0, 0, 0.97)",r.globalAlpha=.6;var l=Date.now();!function t(){V=requestAnimationFrame(t);var e=Date.now(),i=e-l;i>FRAME_TIME&&(l=e-i%FRAME_TIME,c.forEach(function(t){t.length=0}),a.forEach(function(t){t.age>S.MAX_PARTICLE_AGE&&(s.randomize(t).age=0);var e=t.x,i=t.y,n=s(e,i),a=n[2];if(null===a)t.age=S.MAX_PARTICLE_AGE;else{var o=e+n[0],r=i+n[1];null!==s(o,r)[2]?(t.xt=o,t.yt=r,c[h.indexFor(a)].push(t)):(t.x=o,t.y=r)}t.age+=1}),r.globalCompositeOperation="destination-in",r.fillRect(n.x,n.y,n.width,n.height),r.globalCompositeOperation="lighter",r.globalAlpha=.9,c.forEach(function(t,e){0<t.length&&(r.beginPath(),r.strokeStyle=h[e],t.forEach(function(t){r.moveTo(t.x,t.y),r.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),r.stroke())}),p.onDraw&&p.onDraw())}()}R="EPSG:4326"===S.params.projection?function(t,e,i){var n=i.east-i.west,a=i.south-i.north,o=I(i.north)+e/i.height*I(a);return[I(i.west)+t/i.width*I(n),o]}:function(t,e,i){var n=i.east-i.west,a=i.width/I(n)*360/(2*Math.PI),o=a/2*Math.log((1+Math.sin(i.south))/(1-Math.sin(i.south))),r=(i.height+o-e)/a,s=180/Math.PI*(2*Math.atan(Math.exp(r))-Math.PI/2);return[I(i.west)+t/i.width*I(n),s]};var V,F=function(t,e,i){var n=C(i.south),a=C(i.north),o=i.width/(i.east-i.west),r=i.height/(a-n),s=C(E(t));return[(E(e)-i.west)*o,s=(a-s)*r]},O=function(e,i,n,t){var a={south:E(t[0][1]),north:E(t[1][1]),east:E(t[1][0]),west:E(t[0][0]),width:i,height:n};z(),function(t,e){var i=(d=h(t)).header;y=i.lo1,g=Math.max(i.la2,i.la1),v=i.dx,m=i.dy,l=i.nx,u=i.ny,(c=new Date(i.refTime)).setHours(c.getHours()+i.forecastTime),f=[];for(var n=0,a=360<=Math.floor(l*v),o=0;o<u;o++){for(var r=[],s=0;s<l;s++,n++)r[s]=d.data(n);a&&r.push(r[0]),f[o]=r}e({date:c,interpolate:w})}(s,function(t){A(t,function(t,e,i){var n=t[0],a=t[1],o=Math.round(n[0]),r=Math.max(Math.floor(n[1],0),0);Math.min(Math.ceil(a[0],e),e-1);return{x:o,y:r,xMax:e,yMax:Math.min(Math.ceil(a[1],i),i-1),width:e,height:i}}(e,i,n),a,function(t,e){D.field=e,L?N(t,e):function(t,e){if(e){var i=p.canvas,n=i.width,a=i.height,o=i.getContext("2d");o.clearRect(0,0,n,a),o.putImageData(e.overlay,0,0)}}(0,e)})})},z=function(){D.field&&D.field.release(),V&&cancelAnimationFrame(V)},D={params:S.params,start:O,stop:z,update:function(t,e,i,n,a){delete S.params.data,S.params.data=t,a&&O(e,i,n,a)},shift:function(t,e){var i=S.canvas,n=i.width,a=i.height,o=i.getContext("2d");if(t<n&&e<a){var r=function(t,e){return Math.max(0,Math.min(t,e))},s=o.getImageData(r(n,-t),r(a,-e),r(n,n-t),r(a,a-e));o.clearRect(0,0,n,a),o.putImageData(s,r(n,t),r(a,e));for(var h=0,c=particles.length;h<c;h++)particles[h].x+=t,particles[h].y+=e}},createField:T,interpolatePoint:w,setData:function(t){s=t},updateParams:function(t){S.params=t,e(S.params)},getParams:function(){return S.params},buildParams:e};return D}window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/window.FRAME_RATE)},window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});function o(t,e,i){if("undefined"==typeof document)return new i(t,e);var n=document.createElement("canvas");return n.width=t,n.height=e,n}function n(t,e,i){i.endsWith("CCW")&&(e=0<e?e=-e:Math.abs(e));var n=Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),a=180*Math.atan2(t/n,e/n)/Math.PI+180;return"bearingCW"!==i&&"meteoCCW"!==i||360<=(a+=180)&&(a-=360),a}function a(t,e,i){var n=Math.sqrt(Math.pow(t,2)+Math.pow(e,2));return"k/h"===i?s(n):"kt"===i?r(n):n}var r=function(t){return t/.514},s=function(t){return 3.6*t},h=("undefined"==typeof window?{}:window).ol||{};h.layer||(h.layer={}),h.layer.Image||(h.layer.Image=function(){return function(){}}());function t(t,e){void 0===e&&(e={}),this.options=e,this.canvas=null,this.data=t,this.layer_=null,this._windy=null,e.map&&this.appendTo(e.map),this.init=this.init.bind(this),this.handleResize=this.handleResize.bind(this),this.canvasFunction=this.canvasFunction.bind(this),this._addReFreshHandle=this._addReFreshHandle.bind(this)}var e=function(i){function t(t,e){void 0===e&&(e={}),i.call(this,e),this._canvas=null,this.data=t,this.$Windy=null,this.isClear=!1,this.options=e,this.setSource(new h.source.ImageCanvas({logo:e.logo,state:e.state,attributions:e.attributions,resolutions:e.resolutions,canvasFunction:this.canvasFunction.bind(this),ratio:e.hasOwnProperty("ratio")?e.ratio:1})),this.on("precompose",this.redraw,this)}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getData=function(){return this.data},t.prototype.setData=function(t){var e=this.getMap();if(!e)return this;if(this.data=t,this.isClear=!1,!this.$Windy&&this._canvas)this.render(this._canvas),e.renderSync();else if(this.$Windy&&this._canvas){this._cloneLayer&&(e.addLayer(this._cloneLayer),delete this._cloneLayer);var i=this._getExtent();this.$Windy.update(this.getData(),i[0],i[1],i[2],i[3])}else console.warn("please create new instance");return this},t.prototype.render=function(t){var e=this._getExtent();if(this.isClear||!this.getData()||!e)return this;if(t&&!this.$Windy){var i=this.options,n=i.minVelocity,a=i.maxVelocity,o=i.velocityScale,r=i.particleAge,s=i.lineWidth,h=i.particleMultiplier,c=i.colorScale;this.$Windy=new p({canvas:t,projection:this._getProjectionCode(),data:this.getData(),minVelocity:n,maxVelocity:a,velocityScale:o,particleAge:r,lineWidth:s,particleMultiplier:h,colorScale:c}),this.$Windy.start(e[0],e[1],e[2],e[3])}else if(t&&this.$Windy){var l=this._getExtent();this.$Windy.start(l[0],l[1],l[2],l[3])}return this},t.prototype.redraw=function(){if(!this.isClear){var t=this.options.extent||this._getMapExtent();this.setExtent(t)}},t.prototype.canvasFunction=function(t,e,i,n,a){return this._canvas?(this._canvas.width=n[0],this._canvas.height=n[1]):this._canvas=o(n[0],n[1]),e<=this.get("maxResolution")&&this.render(this._canvas),this._canvas},t.prototype._getExtent=function(){var t=this._getMapSize(),e=this._getMapExtent();if(t&&e){var i=this._getProjectionCode(),n=h.proj.transformExtent(e,i,"EPSG:4326");return[[[0,0],[t[0],t[1]]],t[0],t[1],[[n[0],n[1]],[n[2],n[3]]]]}return!1},t.prototype._getMapExtent=function(){if(this.getMap()){var t=this._getMapSize(),e=this.getMap().getView();return e&&e.calculateExtent(t)}},t.prototype._getMapSize=function(){if(this.getMap())return this.getMap().getSize()},t.prototype.appendTo=function(t){if(!(t&&t instanceof h.Map))throw new Error("not map object");this.set("originMap",t),this.getSource().projection_=this._getProjectionCode(),t.addLayer(this)},t.prototype.getPointData=function(t){if(!this.$Windy)return null;var e=this.$Windy.interpolatePoint(t[0],t[1]);return e&&!isNaN(e[0])&&!isNaN(e[1])&&e[2]?{direction:n(e[0],e[1],this.options.angleConvention||"bearingCCW"),speed:a(e[0],e[1],this.options.speedUnit)}:void 0},t.prototype.clearWind=function(){var t=this.getMap();t&&(this.$Windy&&this.$Windy.stop(),this.isClear=!0,this._cloneLayer=this,t.removeLayer(this),this.changed(),this.getMap().renderSync())},t.prototype.removeLayer=function(){var t=this.getMap();t&&(this.$Windy&&this.$Windy.stop(),this.un("precompose",this.redraw,this),t.removeLayer(this),delete this._canvas,delete this.$Windy,delete this._cloneLayer)},t.prototype.setMap=function(t){this.set("originMap",t)},t.prototype.getMap=function(){return this.get("originMap")},t.prototype._getProjectionCode=function(){var t=this.getMap();return t?t.getView()&&t.getView().getProjection().getCode():"EPSG:3857"},t.prototype.updateParams=function(t){if(this.options=Object.assign(this.options,t),this.$Windy){var e=this.options,i=e.minVelocity,n=e.maxVelocity,a=e.velocityScale,o=e.particleAge,r=e.lineWidth,s=e.particleMultiplier,h=e.colorScale;this.$Windy&&(this.$Windy.updateParams({minVelocity:i,maxVelocity:n,velocityScale:a,particleAge:o,lineWidth:r,particleMultiplier:s,colorScale:h}),this.getMap()&&this._canvas&&this.data&&this.render(this._canvas))}return this},t.prototype.getParams=function(){return this.$Windy&&this.$Windy.getParams()},t}(h.layer.Image),c=("undefined"==typeof window?{}:window).AMap||{};t.prototype.appendTo=function(t){if(!t)throw new Error("not map object");this.init(t)},t.prototype.getData=function(){return this.data},t.prototype.setData=function(t){this.data=t,this.map&&this.canvas&&this.data&&this.render(this.canvas)},t.prototype.init=function(t,e){if(!t)throw new Error("not map object");this.map=t,this.context=this.options.context||"2d",this.getCanvasLayer(),this.map.on("resize",this.handleResize,this)},t.prototype.handleResize=function(){this.canvas&&this.canvasFunction()},t.prototype.render=function(t){if(t){var e=this._getExtent();if(!this.getData()||!e)return this;if(t&&!this._windy){var i=this.options,n=i.minVelocity,a=i.maxVelocity,o=i.velocityScale,r=i.particleAge,s=i.lineWidth,h=i.particleMultiplier,c=i.colorScale;this._windy=new p({canvas:t,data:this.getData(),onDraw:function(){},minVelocity:n,maxVelocity:a,velocityScale:o,particleAge:r,lineWidth:s,particleMultiplier:h,colorScale:c}),this._windy.start(e[0],e[1],e[2],e[3])}else t&&this._windy&&this._windy.start(e[0],e[1],e[2],e[3]);return this._addReFreshHandle(),this}},t.prototype._addReFreshHandle=function(){this.map&&"3d"===this.map.getViewMode_().toLowerCase()&&(this.layer_&&this.layer_.reFresh(),c.Util.requestAnimFrame(this._addReFreshHandle))},t.prototype.getCanvasLayer=function(){if(!this.canvas&&!this.layer_){var t=this.canvasFunction(),e=this._getBounds();this.layer_=new c.CanvasLayer({canvas:t,bounds:this.options.bounds||e,zooms:this.options.zooms||[0,22],zIndex:this.options.zIndex||12,opacity:this.options.opacity||1}),this.map.on("mapmove",this.canvasFunction,this),this.map.on("zoomchange",this.canvasFunction,this),this.layer_.setMap(this.map)}},t.prototype.canvasFunction=function(){var t=[this.map.getSize().width,this.map.getSize().height],e=t[0],i=t[1];if(this.canvas){this.canvas.width=e,this.canvas.height=i;var n=this._getBounds();this.layer_&&this.layer_.setBounds(this.options.bounds||n)}else this.canvas=o(e,i,null);return this.render(this.canvas),this.canvas},t.prototype._getBounds=function(){var t=this.map.getViewMode_(),e=[],i=e[0],n=e[1],a=this.map.getBounds();if("2d"===t.toLowerCase())n=a.getNorthEast(),i=a.getSouthWest();else{var o=function(t){var e=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return t.reduce(function(t,e){return[Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.max(e[0],t[2]),Math.max(e[1],t[3])]},e)}(a.bounds.map(function(t){return[t.getLng(),t.getLat()]}));i=new c.LngLat(o[0],o[1]),n=new c.LngLat(o[2],o[3])}return new c.Bounds(i,n)},t.prototype._getExtent=function(){var t=[this.map.getSize().width,this.map.getSize().height],e=t[0],i=t[1],n=this._getBounds().getNorthEast(),a=this._getBounds().getSouthWest();return[[[0,0],[e,i]],e,i,[[a.lng,a.lat],[n.lng,n.lat]]]},t.prototype.removeLayer=function(){this.map&&(this.layer_.setMap(null),this.map.off("resize",this.handleResize,this),this.map.off("mapmove",this.canvasFunction,this),this.map.off("zoomchange",this.canvasFunction,this),delete this.map,delete this.layer_,delete this.canvas)},t.prototype.getContext=function(){return this.canvas.getContext(this.context)},t.prototype.getPointData=function(t){var e=this._windy.interpolatePoint(t[0],t[1]);if(e&&!isNaN(e[0])&&!isNaN(e[1])&&e[2])return{direction:n(e[0],e[1],this.options.angleConvention||"bearingCCW"),speed:a(e[0],e[1],this.options.speedUnit)}},t.prototype.clearWind=function(){this._windy&&this._windy.stop()},t.prototype.updateParams=function(t){if(this.options=Object.assign(this.options,t),this._windy){var e=this.options,i=e.minVelocity,n=e.maxVelocity,a=e.velocityScale,o=e.particleAge,r=e.lineWidth,s=e.particleMultiplier,h=e.colorScale;this._windy&&(this._windy.updateParams({minVelocity:i,maxVelocity:n,velocityScale:a,particleAge:o,lineWidth:r,particleMultiplier:s,colorScale:h}),this.map&&this.canvas&&this.data&&this.render(this.canvas))}return this},t.prototype.getParams=function(){return this._windy&&this._windy.getParams()};var l="undefined"==typeof window?{}:window;return l.BMap||(l.BMap={}),l.BMap.Overlay||(l.BMap.Overlay=function(){return function(){}}()),{AMapWind:t,BMapWind:function(i){function t(t,e){void 0===e&&(e={}),i.call(this,e),this.options=e,this.paneName=this.options.paneName||"mapPane",this.context=this.options.context||"2d",this.zIndex=this.options.zIndex||0,this.mixBlendMode=this.options.mixBlendMode||null,this.enableMassClear=this.options.enableMassClear,this._map=e.map,this._lastDrawTime=null,this.canvas=null,this.data=t,this._windy=null,this.show()}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getData=function(){return this.data},t.prototype.setData=function(t){this.data=t,this._map&&this.data&&this._draw()},t.prototype._getExtent=function(){var t=this._map.getSize(),e=this._map.getBounds().getNorthEast(),i=this._map.getBounds().getSouthWest();return[[[0,0],[t.width,t.height]],t.width,t.height,[[i.lng,i.lat],[e.lng,e.lat]]]},t.prototype.appendTo=function(t){if(!t)throw new Error("not map object");t.addOverlay(this)},t.prototype.initialize=function(t){var e=this;this._map=t;var i=this.canvas=document.createElement("canvas");return i.style.cssText="position:absolute; left:0; top:0; z-index: "+this.zIndex+" ;user-select:none;",i.style.mixBlendMode=this.mixBlendMode,this.adjustSize(),t.getPanes()[this.paneName].appendChild(i),t.addEventListener("resize",function(){e.adjustSize(),e._draw()}),this.canvas},t.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas,i=this.devicePixelRatio=l.devicePixelRatio||1;e.width=t.width*i,e.height=t.height*i,"2d"===this.context&&e.getContext(this.context).scale(i,i),e.style.width=t.width+"px",e.style.height=t.height+"px"},t.prototype.draw=function(){var t=this;clearTimeout(t.timeoutID),t.timeoutID=setTimeout(function(){t._draw()},15)},t.prototype._draw=function(){var t=this._map,e=t.getSize(),i=t.getCenter();if(i){var n=t.pointToOverlayPixel(i);this.canvas.style.left=n.x-e.width/2+"px",this.canvas.style.top=n.y-e.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this),this.render(this.canvas)}},t.prototype.render=function(t){var e=this._getExtent();if(!this.getData()||!e)return this;if(t&&!this._windy){var i=this.options,n=i.minVelocity,a=i.maxVelocity,o=i.velocityScale,r=i.particleAge,s=i.lineWidth,h=i.particleMultiplier,c=i.colorScale;this._windy=new p({canvas:t,data:this.getData(),onDraw:function(){},minVelocity:n,maxVelocity:a,velocityScale:o,particleAge:r,lineWidth:s,particleMultiplier:h,colorScale:c}),this._windy.start(e[0],e[1],e[2],e[3])}else t&&this._windy&&this._windy.start(e[0],e[1],e[2],e[3]);return this},t.prototype.getContainer=function(){return this.canvas},t.prototype.setZIndex=function(t){this.zIndex=t,this.canvas.style.zIndex=this.zIndex},t.prototype.getZIndex=function(){return this.zIndex},t.prototype.getPointData=function(t){var e=this._windy.interpolatePoint(t[0],t[1]);if(e&&!isNaN(e[0])&&!isNaN(e[1])&&e[2])return{direction:n(e[0],e[1],this.options.angleConvention||"bearingCCW"),speed:a(e[0],e[1],this.options.speedUnit)}},t.prototype.clearWind=function(){this._windy&&this._windy.stop()},t.prototype.updateParams=function(t){if(this.options=Object.assign(this.options,t),this._windy){var e=this.options,i=e.minVelocity,n=e.maxVelocity,a=e.velocityScale,o=e.particleAge,r=e.lineWidth,s=e.particleMultiplier,h=e.colorScale;this._windy&&(this._windy.updateParams({minVelocity:i,maxVelocity:n,velocityScale:a,particleAge:o,lineWidth:r,particleMultiplier:s,colorScale:h}),this._map&&this.canvas&&this.data&&this.render(this.canvas))}return this},t.prototype.getParams=function(){return this._windy&&this._windy.getParams()},t}(l.BMap.Overlay),OlWind:e}});
