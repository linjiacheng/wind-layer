{"version":3,"file":"BMapWind.js","sources":["../src/windy/windy.js","../src/helper/index.js","../src/bmap/index.js"],"sourcesContent":["/* eslint-disable */\n\n\n/*  Global class for simulating the movement of particle through a 1km wind grid\n credit: All the credit for this work goes to: https://github.com/cambecc for creating the repo:\n https://github.com/cambecc/earth. The majority of this code is directly take nfrom there, since its awesome.\n This class takes a canvas element and an array of data (1km GFS from http://www.emc.ncep.noaa.gov/index.php?branch=GFS)\n and then uses a mercator (forward/reverse) projection to correctly map wind vectors in \"map space\".\n The \"start\" method takes the bounds of the map at its current extent and starts the whole gridding,\n interpolation and animation process.\n */\n\nconst Windy = function (params) {\n  if (!params.projection) params.projection = 'EPSG:4326';\n  const MIN_VELOCITY_INTENSITY = params.minVelocity || 0;                      // velocity at which particle intensity is minimum (m/s)\n  const MAX_VELOCITY_INTENSITY = params.maxVelocity || 10;                     // velocity at which particle intensity is maximum (m/s)\n  const VELOCITY_SCALE = (params.velocityScale || 0.005) * (Math.pow(window.devicePixelRatio, 1 / 3) || 1); // scale for wind velocity (completely arbitrary--this value looks nice)\n  const OVERLAY_ALPHA = Math.floor(0.4*255);                                   // overlay transparency (on scale [0, 255])\n  const MAX_PARTICLE_AGE = params.particleAge || 90;                         \t // max number of frames a particle is drawn before regeneration\n  const PARTICLE_LINE_WIDTH = params.lineWidth || 1;                           // line width of a drawn particle\n  const PARTICLE_MULTIPLIER = params.particleMultiplier || 1 / 300;            // particle count scalar (completely arbitrary--this values looks nice)\n  const PARTICLE_REDUCTION = (Math.pow(window.devicePixelRatio, 1 / 3) || 1.6);   // multiply particle count for mobiles by this amount\n  const FRAME_RATE = params.frameRate || 15, FRAME_TIME = 1000 / FRAME_RATE;   // desired frames per second\n\n  var defaultColorScale = [\n    \"rgb(36,104, 180)\",\n    \"rgb(60,157, 194)\",\n    \"rgb(128,205,193 )\",\n    \"rgb(151,218,168 )\",\n    \"rgb(198,231,181)\",\n    \"rgb(238,247,217)\",\n    \"rgb(255,238,159)\",\n    \"rgb(252,217,125)\",\n    \"rgb(255,182,100)\",\n    \"rgb(252,150,75)\",\n    \"rgb(250,112,52)\",\n    \"rgb(245,64,32)\",\n    \"rgb(237,45,28)\",\n    \"rgb(220,24,32)\",\n    \"rgb(180,0,35)\"\n  ];\n\n  var defaultOverlayColorScale = [\n    [193,     [37, 4, 42]],\n    [206,     [41, 10, 130]],\n    [219,     [81, 40, 40]],\n    [233.15,  [192, 37, 149]],  // -40 C/F\n    [255.372, [70, 215, 215]],  // 0 F\n    [273.15,  [21, 84, 187]],   // 0 C\n    [275.15,  [24, 132, 14]],   // just above 0 C\n    [291,     [247, 251, 59]],\n    [298,     [235, 167, 21]],\n    [311,     [230, 71, 39]],\n    [328,     [88, 27, 67]]\n  ];\n\n  const colorScale = params.colorScale || defaultColorScale;\n  const overlayColorScale = params.overlayColorScale || defaultOverlayColorScale;\n\n  var NULL_WIND_VECTOR = [NaN, NaN, null];  // singleton for no wind in the form: [u, v, magnitude]\n\n  var builder;\n  var grid;\n  var gridData = params.data;\n  var date;\n  var λ0, φ0, Δλ, Δφ, ni, nj;\n  var isWind = true;\n\n  var setData = function (data) {\n    gridData = data;\n  };\n\n  var bilinearInterpolateScalar = function (x, y, g00, g10, g01, g11) {\n    var rx = (1 - x);\n    var ry = (1 - y);\n    return g00 * rx * ry + g10 * x * ry + g01 * rx * y + g11 * x * y;\n  };\n\n  // interpolation for vectors like wind (u,v,m)\n  var bilinearInterpolateVector = function (x, y, g00, g10, g01, g11) {\n    var rx = (1 - x);\n    var ry = (1 - y);\n    var a = rx * ry, b = x * ry, c = rx * y, d = x * y;\n    var u = g00[0] * a + g10[0] * b + g01[0] * c + g11[0] * d;\n    var v = g00[1] * a + g10[1] * b + g01[1] * c + g11[1] * d;\n    return [u, v, Math.sqrt(u * u + v * v)];\n  };\n\n  var createScalarBuilder = function (scalar) {\n    isWind = false;\n    var data = scalar.data;\n    return {\n      header: scalar.header,\n      interpolate: bilinearInterpolateScalar,\n      data: function(i) {\n        return data[i];\n      }\n    }\n  };\n\n  var createWindBuilder = function (uComp, vComp) {\n    isWind = true;\n    var uData = uComp.data, vData = vComp.data;\n    return {\n      header: uComp.header,\n      //recipe: recipeFor(\"wind-\" + uComp.header.surface1Value),\n      data: function (i) {\n        return [uData[i], vData[i]];\n      },\n      interpolate: bilinearInterpolateVector\n    }\n  };\n\n  var createBuilder = function (data) {\n    var uComp = null, vComp = null, scalar = null;\n\n    data.forEach(function (record) {\n      switch (record.header.parameterCategory + \",\" + record.header.parameterNumber) {\n        case \"1,2\":\n        case \"2,2\":\n          uComp = record;\n          break;\n        case \"1,3\":\n        case \"2,3\":\n          vComp = record;\n          break;\n        default:\n          scalar = record;\n      }\n    });\n\n    return scalar != null ? createScalarBuilder(scalar) : createWindBuilder(uComp, vComp);\n  };\n\n  var buildGrid = function (data, callback) {\n\n    builder = createBuilder(data);\n    var header = builder.header;\n\n    λ0 = header.lo1;\n    φ0 = Math.max(header.la2, header.la1);  // the grid's origin (e.g., 0.0E, 90.0N)\n\n    Δλ = header.dx;\n    Δφ = header.dy;    // distance between grid points (e.g., 2.5 deg lon, 2.5 deg lat)\n\n    ni = header.nx;\n    nj = header.ny;    // number of grid points W-E and N-S (e.g., 144 x 73)\n\n    date = new Date(header.refTime);\n    date.setHours(date.getHours() + header.forecastTime);\n\n    // Scan mode 0 assumed. Longitude increases from λ0, and latitude decreases from φ0.\n    // http://www.nco.ncep.noaa.gov/pmb/docs/grib2/grib2_table3-4.shtml\n    grid = [];\n    var p = 0;\n    var isContinuous = Math.floor(ni * Δλ) >= 360;\n\n    for (var j = 0; j < nj; j++) {\n      var row = [];\n      for (var i = 0; i < ni; i++, p++) {\n        row[i] = builder.data(p);\n      }\n      if (isContinuous) {\n        // For wrapped grids, duplicate first column as last column to simplify interpolation logic\n        row.push(row[0]);\n      }\n      grid[j] = row;\n    }\n\n    callback({\n      date: date,\n      interpolate: interpolate\n    });\n  };\n\n  /**\n   * Get interpolated grid value from Lon/Lat position\n   * @param λ {Float} Longitude\n   * @param φ {Float} Latitude\n   * @returns {Object}\n   */\n  var interpolate = function (λ, φ) {\n\n    if (!grid) return null;\n\n    var i = floorMod(λ - λ0, 360) / Δλ;  // calculate longitude index in wrapped range [0, 360)\n    var j = (φ0 - φ) / Δφ;                 // calculate latitude index in direction +90 to -90\n\n    var fi = Math.floor(i), ci = fi + 1;\n    var fj = Math.floor(j), cj = fj + 1;\n\n    var row;\n    if ((row = grid[fj])) {\n      var g00 = row[fi];\n      var g10 = row[ci];\n      if (isValue(g00) && isValue(g10) && (row = grid[cj])) {\n        var g01 = row[fi];\n        var g11 = row[ci];\n        if (isValue(g01) && isValue(g11)) {\n          // All four points found, so interpolate the value.\n          return builder.interpolate(i - fi, j - fj, g00, g10, g01, g11);\n        }\n      }\n    }\n    return null;\n  };\n\n  /**\n   * @returns {Boolean} true if the specified value is not null and not undefined.\n   */\n  var isValue = function (x) {\n    return x !== null && x !== undefined;\n  };\n\n  /**\n   * @returns {Number} returns remainder of floored division, i.e., floor(a / n). Useful for consistent modulo\n   *          of negative numbers. See http://en.wikipedia.org/wiki/Modulo_operation.\n   */\n  var floorMod = function (a, n) {\n    return a - n * Math.floor(a / n);\n  };\n\n  /**\n   * @returns {Number} the value x clamped to the range [low, high].\n   */\n  var clamp = function (x, range) {\n    return Math.max(range[0], Math.min(x, range[1]));\n  };\n\n  /**\n   * @returns {number} the fraction of the bounds [low, high] covered by the value x, after clamping x to the\n   *          bounds. For example, given bounds=[10, 20], this method returns 1 for x>=20, 0.5 for x=15 and 0\n   *          for x<=10.\n   */\n  var proportion = function (x, low, high) {\n    return (clamp(x, [low, high]) - low) / (high - low);\n  }\n  /**\n   * @returns {Boolean} true if agent is probably a mobile device. Don't really care if this is accurate.\n   */\n  var isMobile = function () {\n    return (/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i).test(navigator.userAgent);\n  };\n\n\n  var colorInterpolator = function (start, end) {\n    var r = start[0], g = start[1], b = start[2];\n    var Δr = end[0] - r, Δg = end[1] - g, Δb = end[2] - b;\n    return function(i, a) {\n        return [Math.floor(r + i * Δr), Math.floor(g + i * Δg), Math.floor(b + i * Δb), a];\n    };\n  }\n\n  /**\n   * Creates a color scale composed of the specified segments. Segments is an array of two-element arrays of the\n   * form [value, color], where value is the point along the scale and color is the [r, g, b] color at that point.\n   * For example, the following creates a scale that smoothly transitions from red to green to blue along the\n   * points 0.5, 1.0, and 3.5:\n   *\n   *     [ [ 0.5, [255, 0, 0] ],\n   *       [ 1.0, [0, 255, 0] ],\n   *       [ 3.5, [0, 0, 255] ] ]\n   *\n   * @param segments array of color segments\n   * @returns {Function} a function(point, alpha) that returns the color [r, g, b, alpha] for the given point.\n   */\n  function segmentedColorScale(segments) {\n    var points = [], interpolators = [], ranges = [];\n    for (var i = 0; i < segments.length - 1; i++) {\n        points.push(segments[i+1][0]);\n        interpolators.push(colorInterpolator(segments[i][1], segments[i+1][1]));\n        ranges.push([segments[i][0], segments[i+1][0]]);\n    }\n\n    return function(point, alpha) {\n        var i;\n        for (i = 0; i < points.length - 1; i++) {\n            if (point <= points[i]) {\n                break;\n            }\n        }\n        var range = ranges[i];\n        return interpolators[i](proportion(point, range[0], range[1]), alpha);\n    };\n  }\n\n  /**\n   * Calculate distortion of the wind vector caused by the shape of the projection at point (x, y). The wind\n   * vector is modified in place and returned by this function.\n   */\n  var distort = function (projection, λ, φ, x, y, scale, wind, windy) {\n    var u = wind[0] * scale;\n    var v = wind[1] * scale;\n    var d = distortion(projection, λ, φ, x, y, windy);\n\n    // Scale distortion vectors by u and v, then add.\n    wind[0] = d[0] * u + d[2] * v;\n    wind[1] = d[1] * u + d[3] * v;\n    return wind;\n  };\n\n  var distortion = function (projection, λ, φ, x, y, windy) {\n    var τ = 2 * Math.PI;\n    // var H = Math.pow(10, -5.2);\n    var H = params.projection === 'EPSG:4326' ? 5 : Math.pow(10, -5.2);\n    var hλ = λ < 0 ? H : -H;\n    var hφ = φ < 0 ? H : -H;\n\n    var pλ = project(φ, λ + hλ, windy);\n    var pφ = project(φ + hφ, λ, windy);\n\n    // Meridian scale factor (see Snyder, equation 4-3), where R = 1. This handles issue where length of 1º λ\n    // changes depending on φ. Without this, there is a pinching effect at the poles.\n    var k = Math.cos(φ / 360 * τ);\n    return [\n      (pλ[0] - x) / hλ / k,\n      (pλ[1] - y) / hλ / k,\n      (pφ[0] - x) / hφ,\n      (pφ[1] - y) / hφ\n    ];\n  };\n\n  var createMask = function (bounds) {\n    var canvas = document.createElement('canvas');\n    var width = bounds.width;\n    var height = bounds.height;\n    canvas.width = width;\n    canvas.height = height;\n    var context = canvas.getContext(\"2d\");\n    context.fillStyle = \"rgba(255, 0, 0, 1)\";\n    context.fill();\n\n    var imageData = context.getImageData(0, 0, width, height);\n    var data = imageData.data;  // layout: [r, g, b, a, r, g, b, a, ...]\n    return {\n        imageData: imageData,\n        isVisible: function(x, y) {\n            var i = (y * width + x) * 4;\n            return data[i + 3] > 0;  // non-zero alpha means pixel is visible\n        },\n        set: function(x, y, rgba) {\n            var i = (y * width + x) * 4;\n            data[i    ] = rgba[0];\n            data[i + 1] = rgba[1];\n            data[i + 2] = rgba[2];\n            data[i + 3] = rgba[3];\n            return this;\n        }\n    };\n  };\n\n  var createField = function (columns, bounds, mask, callback) {\n\n    /**\n     * @returns {Array} wind vector [u, v, magnitude] at the point (x, y), or [NaN, NaN, null] if wind\n     *          is undefined at that point.\n     */\n    function field (x, y) {\n      var column = columns[Math.round(x)];\n      return column && column[Math.round(y)] || NULL_WIND_VECTOR;\n    }\n\n    // Frees the massive \"columns\" array for GC. Without this, the array is leaked (in Chrome) each time a new\n    // field is interpolated because the field closure's context is leaked, for reasons that defy explanation.\n    field.release = function () {\n      columns = [];\n    };\n\n    field.randomize = function (o) {  // UNDONE: this method is terrible\n      var x, y;\n      var safetyNet = 0;\n      do {\n        x = Math.round(Math.floor(Math.random() * bounds.width) + bounds.x);\n        y = Math.round(Math.floor(Math.random() * bounds.height) + bounds.y)\n      } while (field(x, y)[2] === null && safetyNet++ < 30);\n      o.x = x;\n      o.y = y;\n      return o;\n    };\n\n    field.overlay = mask.imageData;\n\n    callback(bounds, field);\n  };\n\n  var buildBounds = function (bounds, width, height) {\n    var upperLeft = bounds[0];\n    var lowerRight = bounds[1];\n    var x = Math.round(upperLeft[0]); //Math.max(Math.floor(upperLeft[0], 0), 0);\n    var y = Math.max(Math.floor(upperLeft[1], 0), 0);\n    var xMax = Math.min(Math.ceil(lowerRight[0], width), width - 1);\n    var yMax = Math.min(Math.ceil(lowerRight[1], height), height - 1);\n    return {x: x, y: y, xMax: width, yMax: yMax, width: width, height: height};\n  };\n\n  var deg2rad = function (deg) {\n    return (deg / 180) * Math.PI;\n  };\n\n  var rad2deg = function (ang) {\n    return ang / (Math.PI / 180.0);\n  };\n\n  var invert\n\n  if (params.projection === 'EPSG:4326') {\n    invert = function (x, y, windy) {\n      var mapLonDelta = windy.east - windy.west;\n      var mapLatDelta = windy.south - windy.north;\n      var lat = rad2deg(windy.north) + y / windy.height * rad2deg(mapLatDelta);\n      var lon = rad2deg(windy.west) + x / windy.width * rad2deg(mapLonDelta);\n      return [lon, lat];\n    };\n  } else {\n    invert = function (x, y, windy) {\n      var mapLonDelta = windy.east - windy.west;\n      var worldMapRadius = windy.width / rad2deg(mapLonDelta) * 360 / (2 * Math.PI);\n      var mapOffsetY = (worldMapRadius / 2 * Math.log((1 + Math.sin(windy.south)) / (1 - Math.sin(windy.south))));\n      var equatorY = windy.height + mapOffsetY;\n      var a = (equatorY - y) / worldMapRadius;\n      var lat = 180 / Math.PI * (2 * Math.atan(Math.exp(a)) - Math.PI / 2);\n      var lon = rad2deg(windy.west) + x / windy.width * rad2deg(mapLonDelta);\n      return [lon, lat];\n    };\n  }\n\n  var mercY = function (lat) {\n    return Math.log(Math.tan(lat / 2 + Math.PI / 4));\n  };\n\n\n  var project = function (lat, lon, windy) { // both in radians, use deg2rad if neccessary\n    var ymin = mercY(windy.south);\n    var ymax = mercY(windy.north);\n    var xFactor = windy.width / (windy.east - windy.west);\n    var yFactor = windy.height / (ymax - ymin);\n\n    var y = mercY(deg2rad(lat));\n    var x = (deg2rad(lon) - windy.west) * xFactor;\n    var y = (ymax - y) * yFactor; // y points south\n    return [x, y];\n  };\n\n  var interpolateField = function (grid, bounds, extent, callback) {\n\n    var mask = createMask(bounds);\n\n    var projection = {};\n    var mapArea = ((extent.south - extent.north) * (extent.west - extent.east));\n    var velocityScale = VELOCITY_SCALE * Math.pow(mapArea, 0.4);\n\n    var columns = [];\n    var x = bounds.x;\n\n    function interpolateColumn (x) {\n      var column = [];\n      for (var y = bounds.y; y <= bounds.yMax; y += 2) {\n        var coord = invert(x, y, extent);\n        var color = [0, 0, 0, 0];\n        if (coord) {\n          var λ = coord[0], φ = coord[1];\n          if (isFinite(λ)) {\n            var wind = grid.interpolate(λ, φ);\n            var scalar = null;\n            if (wind) {\n              if (isWind) {\n                wind = distort(projection, λ, φ, x, y, velocityScale, wind, extent);\n                column[y + 1] = column[y] = wind;\n              }\n              else {\n                scalar = wind;\n              }\n            }\n            if(isValue(scalar)) {\n              color = (segmentedColorScale(overlayColorScale))(scalar, OVERLAY_ALPHA);\n            }\n          }\n        }\n        mask.set(x, y, color).set(x+1, y, color).set(x, y+1, color).set(x+1, y+1, color);\n      }\n      columns[x + 1] = columns[x] = column;\n    }\n\n    (function batchInterpolate () {\n      var start = Date.now();\n      while (x < bounds.width) {\n        interpolateColumn(x);\n        x += 2;\n        if ((Date.now() - start) > 1000) { //MAX_TASK_TIME) {\n          setTimeout(batchInterpolate, 25);\n          return;\n        }\n      }\n      createField(columns, bounds, mask, callback);\n    })();\n  };\n\n  var animationLoop;\n  var animate = function (bounds, field) {\n\n    function windIntensityColorScale (min, max) {\n\n      colorScale.indexFor = function (m) {  // map velocity speed to a style\n        return Math.max(0, Math.min((colorScale.length - 1),\n          Math.round((m - min) / (max - min) * (colorScale.length - 1))));\n\n      };\n\n      return colorScale;\n    }\n\n    var colorStyles = windIntensityColorScale(MIN_VELOCITY_INTENSITY, MAX_VELOCITY_INTENSITY);\n    var buckets = colorStyles.map(function () {\n      return [];\n    });\n\n    var particleCount = Math.round(bounds.width * bounds.height * PARTICLE_MULTIPLIER);\n    if (isMobile()) {\n      particleCount *= PARTICLE_REDUCTION;\n    }\n\n    var fadeFillStyle = \"rgba(0, 0, 0, 0.97)\";\n\n    var particles = [];\n    for (var i = 0; i < particleCount; i++) {\n      particles.push(field.randomize({age: Math.floor(Math.random() * MAX_PARTICLE_AGE) + 0}));\n    }\n\n    function evolve () {\n      buckets.forEach(function (bucket) {\n        bucket.length = 0;\n      });\n      particles.forEach(function (particle) {\n        if (particle.age > MAX_PARTICLE_AGE) {\n          field.randomize(particle).age = 0;\n        }\n        var x = particle.x;\n        var y = particle.y;\n        var v = field(x, y);  // vector at current position\n        var m = v[2];\n        if (m === null) {\n          particle.age = MAX_PARTICLE_AGE;  // particle has escaped the grid, never to return...\n        }\n        else {\n          var xt = x + v[0];\n          var yt = y + v[1];\n          if (field(xt, yt)[2] !== null) {\n            // Path from (x,y) to (xt,yt) is visible, so add this particle to the appropriate draw bucket.\n            particle.xt = xt;\n            particle.yt = yt;\n            buckets[colorStyles.indexFor(m)].push(particle);\n          }\n          else {\n            // Particle isn't visible, but it still moves through the field.\n            particle.x = xt;\n            particle.y = yt;\n          }\n        }\n        particle.age += 1;\n      });\n    }\n\n    var g = params.canvas.getContext(\"2d\");\n    g.lineWidth = PARTICLE_LINE_WIDTH;\n    g.fillStyle = fadeFillStyle;\n    g.globalAlpha = 0.6;\n\n    function draw () {\n      // Fade existing particle trails.\n      var prev = \"lighter\";\n      g.globalCompositeOperation = \"destination-in\";\n      g.fillRect(bounds.x, bounds.y, bounds.width, bounds.height);\n      g.globalCompositeOperation = prev;\n      g.globalAlpha = 0.9;\n\n      // Draw new particle trails.\n      buckets.forEach(function (bucket, i) {\n        if (bucket.length > 0) {\n          g.beginPath();\n          g.strokeStyle = colorStyles[i];\n          bucket.forEach(function (particle) {\n            g.moveTo(particle.x, particle.y);\n            g.lineTo(particle.xt, particle.yt);\n            particle.x = particle.xt;\n            particle.y = particle.yt;\n          });\n          g.stroke();\n        }\n      });\n    }\n\n    var then = Date.now();\n    (function frame () {\n      animationLoop = requestAnimationFrame(frame);\n      var now = Date.now();\n      var delta = now - then;\n      if (delta > FRAME_TIME) {\n        then = now - (delta % FRAME_TIME);\n        evolve();\n        draw();\n      }\n    })();\n  };\n\n  var overlay = function (bounds, field) {\n    if (!field) return;\n\n    var canvas = params.canvas, w = canvas.width, h = canvas.height, ctx = canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, w, h);\n    ctx.putImageData(field.overlay, 0, 0);\n  }\n\n  var updateData = function (data, bounds, width, height, extent) {\n    delete params.data;\n    params.data = data;\n    if (extent)\n      start(bounds, width, height, extent);\n  };\n\n  var start = function (bounds, width, height, extent) {\n    var mapBounds = {\n      south: deg2rad(extent[0][1]),\n      north: deg2rad(extent[1][1]),\n      east: deg2rad(extent[1][0]),\n      west: deg2rad(extent[0][0]),\n      width: width,\n      height: height\n    };\n\n    stop();\n\n    // build grid\n    buildGrid(gridData, function (grid) {\n      // interpolateField\n      interpolateField(grid, buildBounds(bounds, width, height), mapBounds, function (bounds, field) {\n        // animate the canvas with random points\n        windy.field = field;\n        if(isWind) {\n          animate(bounds, field);\n        }\n        else {\n          overlay(bounds, field);\n        }\n        \n      });\n\n    });\n  };\n\n  var stop = function () {\n    if (windy.field) windy.field.release();\n    if (animationLoop) cancelAnimationFrame(animationLoop);\n  };\n\n  var shift = function (dx, dy) {\n    var canvas = params.canvas, w = canvas.width, h = canvas.height, ctx = canvas.getContext(\"2d\");\n    if (w > dx && h > dy) {\n      var clamp = function (high, value) {\n        return Math.max(0, Math.min(high, value));\n      };\n      var imageData = ctx.getImageData(clamp(w, -dx), clamp(h, -dy), clamp(w, w - dx), clamp(h, h - dy));\n      ctx.clearRect(0, 0, w, h);\n      ctx.putImageData(imageData, clamp(w, dx), clamp(h, dy));\n      for (var i = 0, pLength = particles.length; i < pLength; i++) {\n        particles[i].x += dx;\n        particles[i].y += dy;\n      }\n    }\n  };\n\n  var windy = {\n    params: params,\n    start: start,\n    stop: stop,\n    update: updateData,\n    shift: shift,\n    createField: createField,\n    interpolatePoint: interpolate,\n    setData: setData\n  };\n\n  return windy;\n};\n\n// polyfill\nwindow.requestAnimationFrame = (function () {\n  return window.requestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.oRequestAnimationFrame ||\n    window.msRequestAnimationFrame ||\n    function (callback) {\n      return window.setTimeout(callback, 1000 / FRAME_RATE);\n    };\n})();\n\nif (!window.cancelAnimationFrame) {\n  window.cancelAnimationFrame = function (id) {\n    clearTimeout(id);\n  };\n}\n\nexport default Windy\n","/**\n * create canvas\n * @param width\n * @param height\n * @param Canvas\n * @returns {HTMLCanvasElement}\n */\nconst createCanvas = (width, height, Canvas) => {\n  if (typeof document !== 'undefined') {\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    return canvas\n  } else {\n    // create a new canvas instance in node.js\n    // the canvas class needs to have a default constructor without any parameter\n    return new Canvas(width, height);\n  }\n};\n\nconst getDirection = (uMs, vMs, angleConvention) => {\n  // Default angle convention is CW\n  if (angleConvention.endsWith('CCW')) {\n    // vMs comes out upside-down..\n    vMs = vMs > 0 ? vMs = -vMs : Math.abs(vMs);\n  }\n  const velocityAbs = Math.sqrt(Math.pow(uMs, 2) + Math.pow(vMs, 2));\n  const velocityDir = Math.atan2(uMs / velocityAbs, vMs / velocityAbs);\n  let velocityDirToDegrees = velocityDir * 180 / Math.PI + 180;\n  if (angleConvention === 'bearingCW' || angleConvention === 'meteoCCW') {\n    velocityDirToDegrees += 180;\n    if (velocityDirToDegrees >= 360) velocityDirToDegrees -= 360;\n  }\n  return velocityDirToDegrees;\n};\n\nconst getSpeed = (uMs, vMs, unit) => {\n  const velocityAbs = Math.sqrt(Math.pow(uMs, 2) + Math.pow(vMs, 2));\n  // Default is m/s\n  if (unit === 'k/h') {\n    return meterSec2kilometerHour(velocityAbs);\n  } else if (unit === 'kt') {\n    return meterSec2Knots(velocityAbs);\n  } else {\n    return velocityAbs;\n  }\n};\n\nconst meterSec2Knots = (meters) => {\n  return meters / 0.514\n};\n\nconst meterSec2kilometerHour = (meters) => {\n  return meters * 3.6\n};\n\nexport {\n  getSpeed,\n  createCanvas,\n  getDirection\n}\n","import Windy from '../windy/windy';\nimport { getDirection, getSpeed } from '../helper';\n\nconst global = typeof window === 'undefined' ? {} : window;\n\nif (!global.BMap) global.BMap = {};\n\nif (!global.BMap.Overlay) global.BMap.Overlay = class Overlay {};\n\nclass BaiduWind extends global.BMap.Overlay {\n  constructor (data, options = {}) {\n    super(options);\n    this.options = options;\n    this.paneName = this.options.paneName || 'mapPane';\n    this.context = this.options.context || '2d';\n    this.zIndex = this.options.zIndex || 0;\n    this.mixBlendMode = this.options.mixBlendMode || null;\n    this.enableMassClear = this.options.enableMassClear;\n    this._map = options.map;\n    this._lastDrawTime = null;\n\n    /**\n     * 矢量图层\n     * @type {null}\n     */\n    this.canvas = null;\n\n    /**\n     * windy 数据\n     */\n    this.data = data;\n\n    /**\n     * windy layer\n     * @type {null}\n     */\n    this._windy = null;\n    this.show();\n  }\n\n  /**\n   * get layer data\n   * @returns {*}\n   */\n  getData () {\n    return this.data;\n  }\n\n  /**\n   * set data\n   * @param data\n   */\n  setData (data) {\n    this.data = data;\n    if (this._map && this.data) {\n      this._draw();\n    }\n  }\n\n  /**\n   * bounds, width, height, extent\n   * @returns {*}\n   * @private\n   */\n  _getExtent () {\n    const size = this._map.getSize();\n    const _ne = this._map.getBounds().getNorthEast();\n    const _sw = this._map.getBounds().getSouthWest();\n    return [\n      [[0, 0], [size.width, size.height]],\n      size.width,\n      size.height,\n      [[_ne.lng, _ne.lat], [_sw.lng, _sw.lat]]\n    ]\n  }\n\n  /**\n   * append layer to map\n   * @param map\n   */\n  appendTo (map) {\n    if (map) {\n      map.addOverlay(this);\n    } else {\n      throw new Error('not map object');\n    }\n  }\n\n  initialize (map) {\n    this._map = map;\n    const canvas = this.canvas = document.createElement('canvas');\n    canvas.style.cssText = `position:absolute; left:0; top:0; z-index: ${this.zIndex} ;user-select:none;`;\n    canvas.style.mixBlendMode = this.mixBlendMode;\n    this.adjustSize();\n    map.getPanes()[this.paneName].appendChild(canvas);\n    map.addEventListener('resize', () => {\n      this.adjustSize();\n      this._draw();\n    });\n    return this.canvas\n  }\n\n  adjustSize () {\n    const size = this._map.getSize();\n    const canvas = this.canvas;\n    const devicePixelRatio = this.devicePixelRatio = global.devicePixelRatio || 1;\n    canvas.width = size.width * devicePixelRatio;\n    canvas.height = size.height * devicePixelRatio;\n    if (this.context === '2d') {\n      canvas.getContext(this.context).scale(devicePixelRatio, devicePixelRatio)\n    }\n    canvas.style.width = size.width + 'px';\n    canvas.style.height = size.height + 'px';\n  }\n\n  draw () {\n    const self = this;\n    clearTimeout(self.timeoutID);\n    self.timeoutID = setTimeout(function () {\n      self._draw()\n    }, 15);\n  }\n\n  _draw () {\n    const map = this._map;\n    const size = map.getSize();\n    const center = map.getCenter();\n    if (center) {\n      const pixel = map.pointToOverlayPixel(center);\n      this.canvas.style.left = pixel.x - size.width / 2 + 'px';\n      this.canvas.style.top = pixel.y - size.height / 2 + 'px';\n      this.dispatchEvent('draw');\n      this.options.update && this.options.update.call(this);\n      this.render(this.canvas);\n    }\n  }\n\n  /**\n   * render windy layer\n   * @param canvas\n   * @returns {BaiduWind}\n   */\n  render (canvas) {\n    const extent = this._getExtent();\n    if (!this.getData() || !extent) return this;\n    if (canvas && !this._windy) {\n      this._windy = new Windy({\n        canvas: canvas,\n        data: this.getData(),\n        'onDraw': () => {\n        }\n      });\n      this._windy.start(extent[0], extent[1], extent[2], extent[3]);\n    } else if (canvas && this._windy) {\n      this._windy.start(extent[0], extent[1], extent[2], extent[3]);\n    }\n    return this;\n  }\n\n  getContainer () {\n    return this.canvas;\n  }\n\n  setZIndex (zIndex) {\n    this.zIndex = zIndex;\n    this.canvas.style.zIndex = this.zIndex;\n  }\n\n  getZIndex () {\n    return this.zIndex;\n  }\n\n  /**\n   * get mouse point data\n   * @param coordinates\n   * @returns {{direction: number, speed: *}}\n   */\n  getPointData (coordinates) {\n    const gridValue = this._windy.interpolatePoint(coordinates[0], coordinates[1]);\n    if (gridValue && !isNaN(gridValue[0]) && !isNaN(gridValue[1]) && gridValue[2]) {\n      return {\n        direction: getDirection(gridValue[0], gridValue[1], this.options.angleConvention || 'bearingCCW'),\n        speed: getSpeed(gridValue[0], gridValue[1], this.options.speedUnit)\n      }\n    }\n  }\n\n  /**\n   * clear wind\n   */\n  clearWind () {\n    if (this._windy) this._windy.stop();\n  }\n}\n\nexport default BaiduWind;\n"],"names":["Windy","params","projection","MIN_VELOCITY_INTENSITY","minVelocity","MAX_VELOCITY_INTENSITY","maxVelocity","VELOCITY_SCALE","velocityScale","Math","pow","window","devicePixelRatio","OVERLAY_ALPHA","floor","MAX_PARTICLE_AGE","particleAge","PARTICLE_LINE_WIDTH","lineWidth","PARTICLE_MULTIPLIER","particleMultiplier","PARTICLE_REDUCTION","FRAME_RATE","frameRate","FRAME_TIME","defaultColorScale","defaultOverlayColorScale","colorScale","overlayColorScale","NULL_WIND_VECTOR","NaN","builder","grid","gridData","data","date","λ0","φ0","Δλ","Δφ","ni","nj","isWind","setData","bilinearInterpolateScalar","x","y","g00","g10","g01","g11","rx","ry","bilinearInterpolateVector","a","b","c","d","u","v","sqrt","createScalarBuilder","scalar","header","interpolate","i","createWindBuilder","uComp","vComp","uData","vData","createBuilder","forEach","record","parameterCategory","parameterNumber","buildGrid","callback","lo1","max","la2","la1","dx","dy","nx","ny","Date","refTime","setHours","getHours","forecastTime","p","isContinuous","j","row","push","λ","φ","floorMod","fi","ci","fj","cj","isValue","undefined","n","clamp","range","min","proportion","low","high","isMobile","test","navigator","userAgent","colorInterpolator","start","end","r","g","Δr","Δg","Δb","segmentedColorScale","segments","points","interpolators","ranges","length","point","alpha","distort","scale","wind","windy","distortion","τ","PI","H","hλ","hφ","pλ","project","pφ","k","cos","createMask","bounds","canvas","document","createElement","width","height","context","getContext","fillStyle","fill","imageData","getImageData","isVisible","set","rgba","createField","columns","mask","field","column","round","release","randomize","o","safetyNet","random","overlay","buildBounds","upperLeft","lowerRight","xMax","ceil","yMax","deg2rad","deg","rad2deg","ang","invert","mapLonDelta","east","west","mapLatDelta","south","north","lat","lon","worldMapRadius","mapOffsetY","log","sin","equatorY","atan","exp","mercY","tan","ymin","ymax","xFactor","yFactor","interpolateField","extent","mapArea","interpolateColumn","coord","color","isFinite","batchInterpolate","now","setTimeout","animationLoop","animate","windIntensityColorScale","indexFor","m","colorStyles","buckets","map","particleCount","fadeFillStyle","particles","age","evolve","bucket","particle","xt","yt","globalAlpha","draw","prev","globalCompositeOperation","fillRect","beginPath","strokeStyle","moveTo","lineTo","stroke","then","frame","requestAnimationFrame","delta","w","h","ctx","clearRect","putImageData","updateData","mapBounds","stop","cancelAnimationFrame","shift","value","pLength","update","interpolatePoint","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","id","clearTimeout","getDirection","uMs","vMs","angleConvention","endsWith","abs","velocityAbs","velocityDir","atan2","velocityDirToDegrees","getSpeed","unit","meterSec2kilometerHour","meterSec2Knots","meters","global","BMap","Overlay","BaiduWind","options","paneName","zIndex","mixBlendMode","enableMassClear","_map","_lastDrawTime","_windy","show","getData","_draw","_getExtent","size","getSize","_ne","getBounds","getNorthEast","_sw","getSouthWest","lng","appendTo","addOverlay","Error","initialize","style","cssText","adjustSize","getPanes","appendChild","addEventListener","self","timeoutID","center","getCenter","pixel","pointToOverlayPixel","left","top","dispatchEvent","call","render","getContainer","setZIndex","getZIndex","getPointData","coordinates","gridValue","isNaN","direction","speed","speedUnit","clearWind"],"mappings":"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"}